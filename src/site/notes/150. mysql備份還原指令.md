---
{"dg-publish":true,"permalink":"/150. mysqlå‚™ä»½é‚„åŸæŒ‡ä»¤/","tags":["ğŸ³","gardenEntry"],"created":"","updated":""}
---


# ç¡ç¡å¿µ

èª¿æ•´è‡ªå‹•å–å¾—letsEncriptçš„æ¶æ§‹ï¼Œ
æ‰€ä»¥å°±ç¨ç«‹é–‹äº†ä¸€å€‹serverï¼Œè¦æŠŠæœå‹™ç§»éå»ã€‚
ç„¶å¾Œæ‰ç™¼ç¾ï¼Œæˆ‘çš„ä¸Šä¸€ä»»æ˜¯å€‹å¾ˆæˆç†Ÿçš„å·¥ç¨‹å¸«ï¼Œæœ€æ„›é€ è¼ªå­

# æ­£æ–‡

ä»¥ä¸‹éƒ½æ˜¯ç”±dockerå»ºç«‹ï¼Œä¹Ÿæœ‰å…¶ä»–æ–¹å¼å¯ä»¥åšã€‚

- å‚™ä»½å…¨éƒ¨dbçš„æŒ‡ä»¤
```
docker exec percona sh -c "mysqldump -u root -p<password> -A --opt" > backup.sql
```

ç•¶ç„¶ï¼Œä¹Ÿå¯ä»¥é¸æ“‡é€²å…¥åˆ°containerè£é¢ï¼ŒåŸ·è¡ŒæŒ‡ä»¤ï¼Œå†ç”¨docker cpçš„æ–¹å¼æŠŠæª”æ¡ˆæ‹‰å‡ºä¾†ã€‚

- é‚„åŸDBçš„æŒ‡ä»¤
```
docker exec -i mysql sh -c "mysql -u root -p<password>" < backup.sql  
```
- é€£ç·šè‡³mysql
```
mysql -uroot -p<password>
```
- é¡¯ç¤ºå…¨éƒ¨DB
```sql
show databases;
```
- é¡¯ç¤ºå…¨éƒ¨table
```sql
show tables;
```
- å»ºç«‹ä½¿ç”¨è€…
```sql
CREATE USER 'totp-auth'@'localhost' IDENTIFIED BY 'password';
```
é€™é‚Šæ³¨æ„ï¼Œå¦‚æœä½¿ç”¨è€…æ˜¯å¾éæœ¬åœ°é€£éä¾†è³‡æ–™åº«çš„è©±ï¼Œä¸è¦ä½¿ç”¨localhostã€‚æˆ‘å¿˜äº†é€™é»ã€‚

- ä¿®æ”¹ä½¿ç”¨è€…
```sql
RENAME USER 'totp-auth'@'localhost' TO 'totp-auth'@'%';
```
æ‰¿æ¥ä¸Šä¸€æ®µèªæ³•ï¼Œå¦‚æœå·²ç¶“æ–°å¢çš„è©±ï¼Œç”¨æ­¤æ–¹å¼ä¿®æ”¹ã€‚
%ç‚ºä»»æ„ipï¼Œæˆ–è€…å¯ä»¥æ”¹æˆ192.168.1.% è«¸å¦‚æ­¤é¡çš„ã€‚
- æˆäºˆä½¿ç”¨è€…DBæ¬Šé™
```sql
GRANT ALL PRIVILEGES ON db.* TO 'totp-auth'@'localhost';
```


ref. 
- [percona(dockerhub)](https://hub.docker.com/_/percona)
- [[MySQL]è³‡æ–™åº«çš„å‚™ä»½èˆ‡é‚„åŸ](http://www.vixual.net/blog/archives/53)
- [MySQL æ–°å¢ä½¿ç”¨è€…åŠå»ºç«‹è³‡æ–™åº«æ¬Šé™](https://www.ltsplus.com/mysql/mysql-add-new-users-databases-privileges)
- [MySQL users changed their IP address. What's the best way to deal with this?](https://serverfault.com/questions/329795/mysql-users-changed-their-ip-address-whats-the-best-way-to-deal-with-this)
- [æ¯å¤©å®šæ™‚è‡ªå‹•å‚™ä»½Dockerå…§çš„MySQLã€MariaDBèˆ‡MongoDBï¼ŒLinuxã€macOSèˆ‡Windowséƒ½å¯ç”¨](https://klab.tw/2022/08/daily-automatic-backup-of-mysql-mariadb-and-mongodb-in-docker/)